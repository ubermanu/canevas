/**
 * silk.js
 * @version 0.2.0
 * @author ubermanu
 * @url git://github.com/ubermanu/silk.js.git
 * @license MIT
 */

var SILK={VERSION:"2",PI2:2*Math.PI},$$=$$||SILK;SILK.Color=function(t){return this.setHex(t)},SILK.Color.prototype={constructor:SILK.Color,r:1,g:1,b:1,setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,i,e){return this.r=t,this.g=i,this.b=e,this},getStyle:function(){var t=255*this.r|0,i=255*this.g|0,e=255*this.b|0;return"rgb("+t+","+i+","+e+")"}},SILK.Vector2=function(t,i){return this.x=t||0,this.y=i||0,this},SILK.Vector2.prototype={constructor:SILK.Vector2,set:function(t,i){return this.x=t,this.y=i,this},copy:function(t){return this.x=t.x,this.y=t.y,this},clone:function(){return new SILK.Vector2(this.x,this.y)},add:function(t){return this.x+=t.x,this.y+=t.y,this},addScalar:function(t){return this.x+=t,this.y+=t,this},sub:function(t){return this.x-=t.x,this.y-=t.y,this},subScalar:function(t){return this.x-=t,this.y-=t,this},mult:function(t){return this.x*=t.x,this.y*=t.y,this},multScalar:function(t){return this.x*=t,this.y*=t,this},div:function(t){return this.x/=t.x,this.y/=t.y,this},divScalar:function(t){return 0==t?new SILK.Vector2:(this.x/=t,this.y/=t,this)},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divScalar(this.length())},limit:function(t){return this.length()>t&&(this.normalize(),this.multScalar(t)),this},distanceTo:function(t){return Math.sqrt(this.distanceToSq(t))},distanceToSq:function(t){var i=this.x-t.x,e=this.y-t.y;return i*i+e*e}},SILK.Camera=function(t){t=t||{},this.type="Camera",this.position=void 0!==t.position?t.position:new SILK.Vector2,this.rotation=void 0!==t.rotation?t.rotation:0,this.zoom=void 0!==t.zoom?t.zoom:1},SILK.Camera.prototype.constructor=SILK.Camera,SILK.Canvas=function(){console.log("SILK.Canvas",SILK.VERSION);var t=document.createElement("canvas"),i=t.getContext("2d");this.domElement=t,this.autoClear=!0,this.setSize=function(i,e){t.width=i,t.height=e,t.style.width=i+"px",t.style.height=e+"px"},this.clear=function(){i.clearRect(0,0,t.width,t.height)},this.render=function(t,e){return t instanceof SILK.Scene?e instanceof SILK.Camera?(this.autoClear&&this.clear(),i.save(),i.translate(e.position.x,e.position.y),i.rotate(e.rotation),i.scale(e.zoom,e.zoom),t.render(i),void i.restore()):void console.error("SILK.Canvas.render: camera is not an instance of SILK.Camera",e):void console.error("SILK.Canvas.render: scene is not an instance of SILK.Scene",t)},this.setSmoothing=function(t){i.imageSmoothingEnabled=t}},SILK.Material=function(t){t=t||{},this.type="Material",this.opacity=void 0!==t.opacity?t.opacity:1},SILK.Material.prototype.constructor=SILK.Material,SILK.Material.prototype.render=function(t){t.globalAlpha=this.opacity},SILK.Object2D=function(t){Object.defineProperty(this,"id",{value:SILK.Object2DIdCount++}),t=t||{},this.type="Object2D",this.parent=null,this.children=[],this.position=void 0!==t.position?t.position:new SILK.Vector2,this.rotation=void 0!==t.rotation?t.rotation:0,this.scale=void 0!==t.scale?t.scale:1,this.visible=void 0===t.visible||t.visible},SILK.Object2D.prototype.constructor=SILK.Object2D,SILK.Object2D.prototype.add=function(t){return t instanceof SILK.Object2D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t)):console.error("SILK.Object2D.add: object is not an instance of SILK.Object2D",t),this},SILK.Object2D.prototype.remove=function(t){var i=this.children.indexOf(t);return i!==-1&&(t.parent=null,this.children.splice(i,1)),this},SILK.Object2DIdCount=0,SILK.Shape=function(t){t=t||{},this.type="Shape",this.points=[],this.autoUpdate=!1},SILK.Shape.prototype.constructor=SILK.Shape,SILK.Shape.prototype.update=Function.prototype,SILK.Shape.prototype.render=function(t){this.autoUpdate&&this.update(),t.beginPath();for(var i=0,e=this.points.length;i<e;i++){var o=this.points[i];0===i?t.moveTo(o[0],o[1]):t.lineTo(o[0],o[1])}t.closePath()},SILK.BasicMaterial=function(t){SILK.Material.call(this,t),t=t||{},this.type="BasicMaterial",this.wireframe=void 0!==t.wireframe&&t.wireframe;var i=void 0!==t.color?t.color:0;this.color=new SILK.Color(i)},SILK.BasicMaterial.prototype=new SILK.Material,SILK.BasicMaterial.prototype.constructor=SILK.BasicMaterial,SILK.BasicMaterial.prototype.render=function(t){SILK.Material.prototype.render.call(this,t),this.wireframe?(t.strokeStyle=this.color.getStyle(),t.stroke()):(t.fillStyle=this.color.getStyle(),t.fill())},SILK.ImageMaterial=function(t){SILK.Material.call(this,t),t=t||{},this.type="ImageMaterial",this.clip=void 0===t.clip||t.clip,this.image=document.createElement("img"),this.image.src=void 0!==t.src?t.src:""},SILK.ImageMaterial.prototype=new SILK.Material,SILK.ImageMaterial.prototype.constructor=SILK.ImageMaterial,SILK.ImageMaterial.prototype.render=function(t){SILK.Material.prototype.render.call(this,t),this.clip&&t.clip(),t.drawImage(this.image,-this.image.width/2,-this.image.height/2)},SILK.SpriteMaterial=function(t){SILK.ImageMaterial.call(this,t),t=t||{},this.type="SpriteMaterial",this.frame=void 0!==t.frame?t.frame:1,this.duration=void 0!==t.duration?t.duration:1,this.x=void 0!==t.x?t.x:0,this.y=void 0!==t.y?t.y:0,this.width=void 0!==t.width?t.width:0,this.height=void 0!==t.height?t.height:0,this.length=void 0!==t.length?t.length:1,this.repeat=void 0===t.repeat||t.repeat},SILK.SpriteMaterial.prototype=new SILK.ImageMaterial,SILK.SpriteMaterial.prototype.constructor=SILK.SpriteMaterial,SILK.SpriteMaterial.prototype.render=function(t){SILK.Material.prototype.render.call(this,t),this.frame+=1/this.duration,this.frame%=this.length,t.drawImage(this.image,this.x+(0|this.frame)*this.width,this.y,this.width,this.height,-this.width/2,-this.height/2,this.width,this.height)},SILK.BoxShape=function(t){t=t||{},this.type="BoxShape",this.width=void 0!==t.width?t.width:0,this.height=void 0!==t.height?t.height:0,this.update()},SILK.BoxShape.prototype=new SILK.Shape,SILK.BoxShape.prototype.constructor=SILK.BoxShape,SILK.BoxShape.prototype.update=function(){var t=this.width/2,i=this.height/2;this.points=[[-t,-i],[-t,i],[t,i],[t,-i]]},SILK.CircleShape=function(t){t=t||{},this.type="CircleShape",this.radius=void 0!==t.radius?t.radius:0},SILK.CircleShape.prototype=new SILK.Shape,SILK.CircleShape.prototype.constructor=SILK.CircleShape,SILK.CircleShape.prototype.render=function(t){t.beginPath(),t.arc(0,0,this.radius,0,2*Math.PI),t.closePath()},SILK.PolygonShape=function(t){t=t||{},this.type="PolygonShape",this.faces=void 0!==t.faces?t.faces:3,this.radius=void 0!==t.radius?t.radius:1,this.update()},SILK.PolygonShape.prototype=new SILK.Shape,SILK.PolygonShape.prototype.constructor=SILK.PolygonShape,SILK.PolygonShape.prototype.update=function(){var t=SILK.PI2/this.faces;this.points=[];for(var i=0,e=this.faces;i<e;i++){var o=new SILK.Vector2(Math.cos(i*t),Math.sin(i*t)).multScalar(this.radius);this.points.push([o.x,o.y])}},SILK.TriangleShape=function(t){t=t||{},t.faces=3,SILK.PolygonShape.call(this,t),this.type="TriangleShape"},SILK.TriangleShape.prototype=new SILK.PolygonShape,SILK.TriangleShape.prototype.constructor=SILK.TriangleShape,SILK.Mesh=function(t,i){SILK.Object2D.call(this),this.type="Mesh",this.shape=void 0!==t?t:new SILK.Shape,this.material=void 0!==i?i:new SILK.BasicMaterial({color:16777215*Math.random()})},SILK.Mesh.prototype=new SILK.Object2D,SILK.Mesh.prototype.constructor=SILK.Mesh,SILK.Mesh.prototype.render=function(t){this.rotation%=SILK.PI2,this.visible&&(t.save(),t.scale(this.scale,this.scale),t.translate(this.position.x,this.position.y),t.rotate(this.rotation),this.shape.render(t),this.material.render(t),t.restore())},SILK.Scene=function(){SILK.Object2D.call(this),this.type="Scene"},SILK.Scene.prototype=new SILK.Object2D,SILK.Scene.prototype.constructor=SILK.Scene,SILK.Scene.prototype.render=function(t,i){for(var e=0,o=i.length;e<o;e++)i[e].render(t),this.render(t,i[e].children)};