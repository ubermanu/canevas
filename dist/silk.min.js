/**
 * silk.js
 * @version 0.2.0
 * @author ubermanu
 * @url git://github.com/ubermanu/silk.js.git
 * @licenseee MIT
 */

var SILK={VERSION:"2",PI2:2*Math.PI},$$=$$||SILK;SILK.Color=function(t){return this.setHex(t)},SILK.Color.prototype={constructor:SILK.Color,r:1,g:1,b:1,setHex:function(t){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,this},setRGB:function(t,e,i){return this.r=t,this.g=e,this.b=i,this},getStyle:function(){var t=255*this.r|0,e=255*this.g|0,i=255*this.b|0;return"rgb("+t+","+e+","+i+")"}},SILK.Vector2=function(t,e){return this.x=t||0,this.y=e||0,this},SILK.Vector2.prototype={constructor:SILK.Vector2,set:function(t,e){return this.x=t,this.y=e,this},copy:function(t){return this.x=t.x,this.y=t.y,this},clone:function(){return new SILK.Vector2(this.x,this.y)},add:function(t){return this.x+=t.x,this.y+=t.y,this},addScalar:function(t){return this.x+=t,this.y+=t,this},sub:function(t){return this.x-=t.x,this.y-=t.y,this},subScalar:function(t){return this.x-=t,this.y-=t,this},mult:function(t){return this.x*=t.x,this.y*=t.y,this},multScalar:function(t){return this.x*=t,this.y*=t,this},div:function(t){return this.x/=t.x,this.y/=t.y,this},divScalar:function(t){return 0==t?new SILK.Vector2:(this.x/=t,this.y/=t,this)},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divScalar(this.length())},limit:function(t){return this.length()>t&&(this.normalize(),this.multScalar(t)),this},distanceTo:function(t){return Math.sqrt(this.distanceToSq(t))},distanceToSq:function(t){var e=this.x-t.x,i=this.y-t.y;return e*e+i*i}},SILK.Camera=function(t){t=t||{},this.type="Camera",this.position=void 0!==t.position?t.position:new SILK.Vector2,this.rotation=void 0!==t.rotation?t.rotation:0,this.zoom=void 0!==t.zoom?t.zoom:1},SILK.Camera.prototype.constructor=SILK.Camera,SILK.Canvas=function(){console.log("SILK.Canvas",SILK.VERSION);var t=document.createElement("canvas"),e=t.getContext("2d");this.domElement=t,this.context=null,this.autoClear=!0,this.setSize=function(e,i){t.width=e,t.height=i,t.style.width=e+"px",t.style.height=i+"px"},this.clear=function(){e.clearRect(0,0,t.width,t.height)},this.render=function(t,i){if(!(t instanceof SILK.Scene))return void console.error("SILK.Canvas.render: scene is not an instance of SILK.Scene",t);if(!(i instanceof SILK.Camera))return void console.error("SILK.Canvas.render: camera is not an instance of SILK.Camera",i);this.autoClear&&this.clear(),e.save(),e.translate(i.position.x,i.position.y),e.rotate(i.rotation),e.scale(i.zoom,i.zoom);for(var r=0,o=t.children.length;r<o;r++)t.children[r].render(e);e.restore()},this.setSmoothing=function(t){e.imageSmoothingEnabled=t}},SILK.Material=function(t){t=t||{},this.type="Material",this.opacity=void 0!==t.opacity?t.opacity:1},SILK.Material.prototype.constructor=SILK.Material,SILK.Material.prototype.render=function(t){t.globalAlpha=this.opacity},SILK.Object2D=function(t){Object.defineProperty(this,"id",{value:SILK.Object2DIdCount++}),t=t||{},this.type="Object2D",this.parent=null,this.children=[],this.position=void 0!==t.position?t.position:new SILK.Vector2,this.rotation=void 0!==t.rotation?t.rotation:0,this.scale=void 0!==t.scale?t.scale:1,this.visible=void 0===t.visible||t.visible},SILK.Object2D.prototype.constructor=SILK.Object2D,SILK.Object2D.prototype.add=function(t){return t instanceof SILK.Object2D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t)):console.error("SILK.Object2D.add: object is not an instance of SILK.Object2D",t),this},SILK.Object2D.prototype.remove=function(t){var e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1)),this},SILK.Object2DIdCount=0,SILK.Shape=function(t){t=t||{},this.type="Shape"},SILK.Shape.prototype.constructor=SILK.Shape,SILK.Shape.prototype.constructor.render=null,SILK.BasicMaterial=function(t){SILK.Material.call(this,t),t=t||{},this.type="BasicMaterial",this.wireframe=void 0!==t.wireframe&&t.wireframe;var e=void 0!==t.color?t.color:0;this.color=new SILK.Color(e)},SILK.BasicMaterial.prototype=Object.create(SILK.Material.prototype),SILK.BasicMaterial.prototype.constructor=SILK.BasicMaterial,SILK.BasicMaterial.prototype.render=function(t){SILK.Material.prototype.render.call(this,t),this.wireframe?(t.strokeStyle=this.color.getStyle(),t.stroke()):(t.fillStyle=this.color.getStyle(),t.fill())},SILK.ImageMaterial=function(t){SILK.Material.call(this,t),t=t||{},this.type="ImageMaterial",this.clip=void 0===t.clip||t.clip,this.image=document.createElement("img"),this.image.src=void 0!==t.src?t.src:""},SILK.ImageMaterial.prototype=Object.create(SILK.Material.prototype),SILK.ImageMaterial.prototype.constructor=SILK.ImageMaterial,SILK.ImageMaterial.prototype.render=function(t){SILK.Material.prototype.render.call(this,t),this.clip&&t.clip(),t.drawImage(this.image,-this.image.width/2,-this.image.height/2)},SILK.SpriteMaterial=function(t){SILK.ImageMaterial.call(this,t),t=t||{},this.type="SpriteMaterial",this.frame=void 0!==t.frame?t.frame:1,this.duration=void 0!==t.duration?t.duration:1,this.x=void 0!==t.x?t.x:0,this.y=void 0!==t.y?t.y:0,this.width=void 0!==t.width?t.width:0,this.height=void 0!==t.height?t.height:0,this.length=void 0!==t.length?t.length:1,this.repeat=void 0===t.repeat||t.repeat},SILK.SpriteMaterial.prototype=Object.create(SILK.ImageMaterial.prototype),SILK.SpriteMaterial.prototype.constructor=SILK.SpriteMaterial,SILK.SpriteMaterial.prototype.render=function(t){SILK.Material.prototype.render.call(this,t),this.frame+=1/this.duration,this.frame%=this.length,t.drawImage(this.image,this.x+(0|this.frame)*this.width,this.y,this.width,this.height,-this.width/2,-this.height/2,this.width,this.height)},SILK.BoxShape=function(t){t=t||{},this.type="BoxShape",this.width=void 0!==t.width?t.width:0,this.height=void 0!==t.height?t.height:0},SILK.BoxShape.prototype=SILK.Shape,SILK.BoxShape.prototype.constructor=SILK.BoxShape,SILK.BoxShape.prototype.render=function(t){var e=this.width/2,i=this.height/2;t.beginPath(),t.moveTo(-e,-i),t.lineTo(-e,i),t.lineTo(e,i),t.lineTo(e,-i),t.closePath()},SILK.CircleShape=function(t){t=t||{},this.type="CircleShape",this.radius=void 0!==t.radius?t.radius:0},SILK.CircleShape.prototype=SILK.Shape,SILK.CircleShape.prototype.constructor=SILK.CircleShape,SILK.CircleShape.prototype.render=function(t){t.beginPath(),t.arc(0,0,this.radius,0,2*Math.PI),t.closePath()},SILK.TriangleShape=function(t){t=t||{},this.type="TriangleShape",this.radius=void 0!==t.radius?t.radius:0},SILK.TriangleShape.prototype=SILK.Shape,SILK.TriangleShape.prototype.constructor=SILK.TriangleShape,SILK.TriangleShape.prototype.render=function(t){var e=Math.PI/180,i=new SILK.Vector2(Math.cos(30*e),Math.sin(30*e)).multScalar(this.radius),r=new SILK.Vector2(Math.cos(150*e),Math.sin(150*e)).multScalar(this.radius),o=new SILK.Vector2(Math.cos(270*e),Math.sin(270*e)).multScalar(this.radius);t.beginPath(),t.moveTo(i.x,i.y),t.lineTo(r.x,r.y),t.lineTo(o.x,o.y),t.closePath()},SILK.Mesh=function(t,e){SILK.Object2D.call(this),this.type="Mesh",this.shape=void 0!==t?t:new SILK.Shape,this.material=void 0!==e?e:new SILK.BasicMaterial({color:16777215*Math.random()})},SILK.Mesh.prototype=Object.create(SILK.Object2D.prototype),SILK.Mesh.prototype.constructor=SILK.Mesh,SILK.Mesh.prototype.render=function(t){this.rotation%=2*Math.PI,this.visible&&(t.save(),t.scale(this.scale,this.scale),t.translate(this.position.x,this.position.y),t.rotate(this.rotation),this.shape.render(t),this.material.render(t),t.restore())},SILK.Scene=function(){SILK.Object2D.call(this),this.type="Scene"},SILK.Scene.prototype=Object.create(SILK.Object2D.prototype),SILK.Scene.prototype.constructor=SILK.Scene;